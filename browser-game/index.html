<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpongeBob Minecraft Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #333;
        }
        
        .game-container {
            width: 100%;
            max-width: 800px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            text-align: center;
            color: #FF9800;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .game-canvas-container {
            position: relative;
            width: 100%;
            height: 450px;
            border: 3px solid #2E7D32;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            background-color: #8BC34A;
        }
        
        canvas {
            display: block;
        }
        
        .ui-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .stats-panel {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }
        
        .health-bar {
            width: 200px;
            height: 20px;
            background-color: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .health-fill {
            height: 100%;
            background-color: #4CAF50;
            width: 100%;
            transition: width 0.3s;
        }
        
        .inventory {
            display: flex;
            gap: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }
        
        .inventory-slot {
            width: 40px;
            height: 40px;
            border: 2px solid #795548;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #A1887F;
            cursor: pointer;
            font-size: 20px;
        }
        
        .inventory-slot.active {
            border-color: #FFC107;
            box-shadow: 0 0 8px #FFC107;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            padding: 10px;
            background-color: #FF9800;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #F57C00;
        }
        
        .instructions {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }
        
        .instructions h3 {
            color: #FF9800;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            list-style-type: none;
            padding-left: 10px;
        }
        
        .instructions li {
            margin-bottom: 5px;
        }
        
        .enemy {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: #f44336;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .boss {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: #9C27B0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
            text-align: center;
        }
        
        .game-over, .victory {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 100;
            display: none;
        }
        
        .game-over h2, .victory h2 {
            font-size: 36px;
            margin-bottom: 20px;
            color: #f44336;
        }
        
        .victory h2 {
            color: #4CAF50;
        }
        
        .save-load {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>SpongeBob Minecraft Adventure</h1>
        
        <div class="ui-container">
            <div class="stats-panel">
                <div>–£—Ä–æ–≤–µ–Ω—å –∑–¥–æ—Ä–æ–≤—å—è:</div>
                <div class="health-bar">
                    <div class="health-fill" id="health-fill"></div>
                </div>
                <div>–ë–ª–æ–∫–∏: <span id="blocks-count">0</span></div>
                <div>–£–±–∏—Ç–æ –≤—Ä–∞–≥–æ–≤: <span id="enemies-defeated">0</span>/3</div>
            </div>
            
            <div class="inventory">
                <div class="inventory-slot active" data-block="grass">üåø</div>
                <div class="inventory-slot" data-block="dirt">üü´</div>
                <div class="inventory-slot" data-block="wood">üü§</div>
                <div class="inventory-slot" data-block="stone">‚¨ú</div>
            </div>
        </div>
        
        <div class="game-canvas-container">
            <canvas id="game-canvas" width="800" height="450"></canvas>
            
            <div class="game-over" id="game-over">
                <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
                <p>–ê–∫—É–ª–∞ –ø–æ–±–µ–¥–∏–ª–∞ –°–ø–∞–Ω—á –ë–æ–±–∞</p>
                <button id="restart-btn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
            </div>
            
            <div class="victory" id="victory">
                <h2>–ü–æ–±–µ–¥–∞!</h2>
                <p>–í—ã –ø–æ–±–µ–¥–∏–ª–∏ –ø–∏—Ä–∞—Ç–∞ –∏ —Å–ø–∞—Å–ª–∏ –ë–∏–∫–∏–Ω–∏ –ë–æ—Ç—Ç–æ–º!</p>
                <button id="next-level-btn">–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å</button>
            </div>
        </div>
        
        <div class="controls">
            <button id="attack-btn">–ê—Ç–∞–∫–æ–≤–∞—Ç—å (–ü—Ä–æ–±–µ–ª)</button>
            <button id="craft-btn">–ö—Ä–∞—Ñ—Ç (C)</button>
            <div class="save-load">
                <button id="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button id="load-btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>
        
        <div class="instructions">
            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</h3>
            <ul>
                <li>WASD - –¥–≤–∏–∂–µ–Ω–∏–µ</li>
                <li>–ü—Ä–æ–±–µ–ª - –∞—Ç–∞–∫–æ–≤–∞—Ç—å –≤—Ä–∞–≥–æ–≤</li>
                <li>–õ–ö–ú - —Ä–∞–∑—Ä—É—à–∞—Ç—å –±–ª–æ–∫–∏</li>
                <li>–ü–ö–ú - —Å—Ç–∞–≤–∏—Ç—å –±–ª–æ–∫–∏</li>
                <li>C - –æ—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –∫—Ä–∞—Ñ—Ç–∞</li>
            </ul>
        </div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const inventorySlots = document.querySelectorAll('.inventory-slot');
        const blocksCountElement = document.getElementById('blocks-count');
        const healthFill = document.getElementById('health-fill');
        const enemiesDefeatedElement = document.getElementById('enemies-defeated');
        const gameOverScreen = document.getElementById('game-over');
        const victoryScreen = document.getElementById('victory');
        const restartBtn = document.getElementById('restart-btn');
        const nextLevelBtn = document.getElementById('next-level-btn');
        const attackBtn = document.getElementById('attack-btn');
        const craftBtn = document.getElementById('craft-btn');
        const saveBtn = document.getElementById('save-btn');
        const loadBtn = document.getElementById('load-btn');
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameRunning = true;
        let player = {
            x: 400,
            y: 250,
            width: 30,
            height: 50,
            velocityX: 0,
            velocityY: 0,
            speed: 3,
            jumpForce: 12,
            grounded: false,
            health: 100,
            blocks: 0,
            enemiesDefeated: 0
        };
        
        let blocks = [];
        let enemies = [];
        let boss = null;
        let gravity = 0.5;
        let selectedBlock = 'grass';
        let camera = { x: 0, y: 0 };
        let attackCooldown = 0;
        let gameLevel = 1;
        
        // –ë–ª–æ–∫–∏ –¥–ª—è –º–∏—Ä–∞
        const blockTypes = {
            grass: { color: '#8BC34A', breakable: true },
            dirt: { color: '#795548', breakable: true },
            wood: { color: '#5D4037', breakable: true },
            stone: { color: '#9E9E9E', breakable: true }
        };
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –º–∏—Ä–∞
        function generateWorld() {
            blocks = [];
            enemies = [];
            boss = null;
            
            // –°–æ–∑–¥–∞–µ–º –∑–µ–º–ª—é
            for (let x = 0; x < 40; x++) {
                for (let y = 0; y < 5; y++) {
                    blocks.push({
                        x: x * 40,
                        y: canvas.height - (y * 40),
                        width: 40,
                        height: 40,
                        type: y === 0 ? 'grass' : 'dirt'
                    });
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ—Ä–µ–≤—å–µ–≤
            for (let i = 0; i < 5; i++) {
                const treeX = 200 + i * 200;
                const treeY = canvas.height - 40;
                
                // –°—Ç–≤–æ–ª –¥–µ—Ä–µ–≤–∞
                for (let j = 0; j < 4; j++) {
                    blocks.push({
                        x: treeX,
                        y: treeY - (j * 40),
                        width: 40,
                        height: 40,
                        type: 'wood'
                    });
                }
                
                // –õ–∏—Å—Ç—å—è –¥–µ—Ä–µ–≤–∞
                for (let dx = -1; dx <= 1; dx++) {
                    for (let dy = -3; dy <= -1; dy++) {
                        if (dx === 0 && dy === -3) continue;
                        blocks.push({
                            x: treeX + dx * 40,
                            y: treeY + dy * 40,
                            width: 40,
                            height: 40,
                            type: 'grass'
                        });
                    }
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–º–Ω–∏
            for (let i = 0; i < 10; i++) {
                blocks.push({
                    x: 100 + i * 80,
                    y: canvas.height - 80,
                    width: 40,
                    height: 40,
                    type: 'stone'
                });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–∞–≥–æ–≤ (–∞–∫—É–ª)
            if (gameLevel === 1) {
                for (let i = 0; i < 3; i++) {
                    enemies.push({
                        x: 300 + i * 150,
                        y: canvas.height - 80,
                        width: 40,
                        height: 40,
                        speed: 1.5,
                        health: 30,
                        damage: 10,
                        attackCooldown: 0,
                        type: 'shark'
                    });
                }
            } else if (gameLevel === 2) {
                // –ë–æ—Å—Å - –ø–∏—Ä–∞—Ç
                boss = {
                    x: 600,
                    y: canvas.height - 80,
                    width: 60,
                    height: 60,
                    speed: 1,
                    health: 100,
                    damage: 20,
                    attackCooldown: 0,
                    type: 'pirate'
                };
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–∫–∞ (SpongeBob)
        function drawPlayer() {
            // –¢–µ–ª–æ (–∫–≤–∞–¥—Ä–∞—Ç –∫–∞–∫ —É –°–ø–∞–Ω—á –ë–æ–±–∞)
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(player.x - camera.x, player.y - camera.y, player.width, player.height);
            
            // –ì–ª–∞–∑–∞
            ctx.fillStyle = 'white';
            ctx.fillRect(player.x - camera.x + 5, player.y - camera.y + 10, 7, 7);
            ctx.fillRect(player.x - camera.x + 18, player.y - camera.y + 10, 7, 7);
            
            ctx.fillStyle = 'brown';
            ctx.fillRect(player.x - camera.x + 6, player.y - camera.y + 11, 5, 5);
            ctx.fillRect(player.x - camera.x + 19, player.y - camera.y + 11, 5, 5);
            
            // –†–æ—Ç
            ctx.fillStyle = 'red';
            ctx.fillRect(player.x - camera.x + 10, player.y - camera.y + 25, 10, 3);
            
            // –ù–æ–≥–∏
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(player.x - camera.x + 5, player.y - camera.y + 45, 8, 5);
            ctx.fillRect(player.x - camera.x + 17, player.y - camera.y + 45, 8, 5);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –∏–≥—Ä–æ–∫–∞
            ctx.fillStyle = 'red';
            ctx.fillRect(player.x - camera.x, player.y - camera.y - 10, player.width, 5);
            ctx.fillStyle = 'green';
            ctx.fillRect(player.x - camera.x, player.y - camera.y - 10, player.width * (player.health / 100), 5);
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—Ä–∞–≥–æ–≤
        function drawEnemies() {
            enemies.forEach(enemy => {
                if (enemy.type === 'shark') {
                    // –ê–∫—É–ª–∞
                    ctx.fillStyle = '#f44336';
                    ctx.beginPath();
                    ctx.ellipse(enemy.x - camera.x + enemy.width/2, enemy.y - camera.y + enemy.height/2, enemy.width/2, enemy.height/2, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // –ì–ª–∞–∑–∞ –∞–∫—É–ª—ã
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(enemy.x - camera.x + enemy.width - 10, enemy.y - camera.y + 10, 5, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // –ó—É–±—ã –∞–∫—É–ª—ã
                    ctx.fillStyle = 'white';
                    for (let i = 0; i < 4; i++) {
                        ctx.fillRect(enemy.x - camera.x + 5 + i*8, enemy.y - camera.y + enemy.height - 10, 5, 5);
                    }
                    
                    // –ü–æ–ª–æ—Å–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
                    ctx.fillStyle = 'red';
                    ctx.fillRect(enemy.x - camera.x, enemy.y - camera.y - 10, enemy.width, 5);
                    ctx.fillStyle = 'green';
                    ctx.fillRect(enemy.x - camera.x, enemy.y - camera.y - 10, enemy.width * (enemy.health / 30), 5);
                }
            });
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –±–æ—Å—Å–∞
            if (boss) {
                ctx.fillStyle = '#9C27B0';
                ctx.fillRect(boss.x - camera.x, boss.y - camera.y, boss.width, boss.height);
                
                // –ì–ª–∞–∑–Ω–∞—è –ø–æ–≤—è–∑–∫–∞
                ctx.fillStyle = 'black';
                ctx.fillRect(boss.x - camera.x + 5, boss.y - camera.y + 10, 15, 5);
                
                // –ë–æ—Ä–æ–¥–∞
                ctx.fillStyle = '#795548';
                ctx.fillRect(boss.x - camera.x + 5, boss.y - camera.y + 40, boss.width - 10, 15);
                
                // –ü–æ–ª–æ—Å–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
                ctx.fillStyle = 'red';
                ctx.fillRect(boss.x - camera.x, boss.y - camera.y - 10, boss.width, 5);
                ctx.fillStyle = 'green';
                ctx.fillRect(boss.x - camera.x, boss.y - camera.y - 10, boss.width * (boss.health / 100), 5);
                
                // –ú–µ—Ç–∫–∞ "–ü–ò–†–ê–¢"
                ctx.fillStyle = 'white';
                ctx.font = '10px Arial';
                ctx.fillText('–ü–ò–†–ê–¢', boss.x - camera.x + 5, boss.y - camera.y + 25);
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –±–ª–æ–∫–æ–≤
        function drawBlocks() {
            blocks.forEach(block => {
                ctx.fillStyle = blockTypes[block.type].color;
                ctx.fillRect(block.x - camera.x, block.y - camera.y, block.width, block.height);
                
                // –ö–æ–Ω—Ç—É—Ä –±–ª–æ–∫–∞
                ctx.strokeStyle = '#000';
                ctx.strokeRect(block.x - camera.x, block.y - camera.y, block.width, block.height);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
        function update() {
            if (!gameRunning) return;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é
            player.velocityY += gravity;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞
            player.x += player.velocityX;
            player.y += player.velocityY;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–ª–∏–∑–∏–∏ —Å –±–ª–æ–∫–∞–º–∏
            player.grounded = false;
            blocks.forEach(block => {
                if (
                    player.x < block.x + block.width &&
                    player.x + player.width > block.x &&
                    player.y < block.y + block.height &&
                    player.y + player.height > block.y
                ) {
                    // –ö–æ–ª–ª–∏–∑–∏—è —Å–≤–µ—Ä—Ö—É
                    if (player.velocityY > 0 && player.y < block.y) {
                        player.y = block.y - player.height;
                        player.velocityY = 0;
                        player.grounded = true;
                    }
                    // –ö–æ–ª–ª–∏–∑–∏—è —Å–Ω–∏–∑—É
                    else if (player.velocityY < 0 && player.y + player.height > block.y + block.height) {
                        player.y = block.y + block.height;
                        player.velocityY = 0;
                    }
                    // –ö–æ–ª–ª–∏–∑–∏—è —Å–ª–µ–≤–∞
                    else if (player.velocityX > 0 && player.x < block.x + block.width) {
                        player.x = block.x - player.width;
                    }
                    // –ö–æ–ª–ª–∏–∑–∏—è —Å–ø—Ä–∞–≤–∞
                    else if (player.velocityX < 0 && player.x + player.width > block.x) {
                        player.x = block.x + block.width;
                    }
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–∞–≥–æ–≤
            updateEnemies();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–æ—Å—Å–∞
            if (boss) {
                updateBoss();
            }
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏–≥—Ä–æ–∫–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –º–∏—Ä–∞
            if (player.x < 0) player.x = 0;
            if (player.x > 2000) player.x = 2000;
            if (player.y > canvas.height) {
                player.y = canvas.height;
                player.velocityY = 0;
                player.grounded = true;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–º–µ—Ä—É (—Å–ª–µ–¥–∏–º –∑–∞ –∏–≥—Ä–æ–∫–æ–º)
            camera.x = player.x - canvas.width / 2 + player.width / 2;
            camera.y = player.y - canvas.height / 2 + player.height / 2;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –º–∏—Ä–∞
            if (camera.x < 0) camera.x = 0;
            if (camera.x > 2000 - canvas.width) camera.x = 2000 - canvas.width;
            if (camera.y < 0) camera.y = 0;
            if (camera.y > canvas.height) camera.y = canvas.height;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            blocksCountElement.textContent = player.blocks;
            enemiesDefeatedElement.textContent = player.enemiesDefeated;
            healthFill.style.width = player.health + '%';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ –ø–æ–±–µ–¥—ã
            if (gameLevel === 1 && player.enemiesDefeated >= 3) {
                gameLevel = 2;
                generateWorld();
            } else if (gameLevel === 2 && boss && boss.health <= 0) {
                victoryScreen.style.display = 'flex';
                gameRunning = false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
            if (player.health <= 0) {
                gameOverScreen.style.display = 'flex';
                gameRunning = false;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫—É –∞—Ç–∞–∫–∏
            if (attackCooldown > 0) {
                attackCooldown--;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤—Ä–∞–≥–æ–≤
        function updateEnemies() {
            enemies.forEach((enemy, index) => {
                // –î–≤–∏–∂–µ–Ω–∏–µ –∫ –∏–≥—Ä–æ–∫—É
                if (enemy.x < player.x) {
                    enemy.x += enemy.speed;
                } else {
                    enemy.x -= enemy.speed;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π —Å –±–ª–æ–∫–∞–º–∏
                let enemyGrounded = false;
                blocks.forEach(block => {
                    if (
                        enemy.x < block.x + block.width &&
                        enemy.x + enemy.width > block.x &&
                        enemy.y < block.y + block.height &&
                        enemy.y + enemy.height > block.y
                    ) {
                        // –ö–æ–ª–ª–∏–∑–∏—è —Å–≤–µ—Ä—Ö—É
                        if (enemy.y < block.y) {
                            enemy.y = block.y - enemy.height;
                            enemyGrounded = true;
                        }
                    }
                });
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é –∫ –≤—Ä–∞–≥–∞–º
                if (!enemyGrounded) {
                    enemy.y += 3;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ç–∞–∫–∏ –≤—Ä–∞–≥–∞
                if (enemy.attackCooldown > 0) {
                    enemy.attackCooldown--;
                }
                
                // –ï—Å–ª–∏ –≤—Ä–∞–≥ –±–ª–∏–∑–∫–æ –∫ –∏–≥—Ä–æ–∫—É - –∞—Ç–∞–∫—É–µ—Ç
                const dist = Math.sqrt(Math.pow(enemy.x - player.x, 2) + Math.pow(enemy.y - player.y, 2));
                if (dist < 50 && enemy.attackCooldown === 0) {
                    player.health -= enemy.damage;
                    enemy.attackCooldown = 60; // 1 —Å–µ–∫—É–Ω–¥–∞ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏
                }
                
                // –ï—Å–ª–∏ –≤—Ä–∞–≥ –º–µ—Ä—Ç–≤, —É–¥–∞–ª—è–µ–º –µ–≥–æ
                if (enemy.health <= 0) {
                    enemies.splice(index, 1);
                    player.enemiesDefeated++;
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –±–æ—Å—Å–∞
        function updateBoss() {
            // –î–≤–∏–∂–µ–Ω–∏–µ –∫ –∏–≥—Ä–æ–∫—É
            if (boss.x < player.x) {
                boss.x += boss.speed;
            } else {
                boss.x -= boss.speed;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π —Å –±–ª–æ–∫–∞–º–∏
            let bossGrounded = false;
            blocks.forEach(block => {
                if (
                    boss.x < block.x + block.width &&
                    boss.x + boss.width > block.x &&
                    boss.y < block.y + block.height &&
                    boss.y + boss.height > block.y
                ) {
                    // –ö–æ–ª–ª–∏–∑–∏—è —Å–≤–µ—Ä—Ö—É
                    if (boss.y < block.y) {
                        boss.y = block.y - boss.height;
                        bossGrounded = true;
                    }
                }
            });
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é –∫ –±–æ—Å—Å—É
            if (!bossGrounded) {
                boss.y += 3;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ç–∞–∫–∏ –±–æ—Å—Å–∞
            if (boss.attackCooldown > 0) {
                boss.attackCooldown--;
            }
            
            // –ï—Å–ª–∏ –±–æ—Å—Å –±–ª–∏–∑–∫–æ –∫ –∏–≥—Ä–æ–∫—É - –∞—Ç–∞–∫—É–µ—Ç
            const dist = Math.sqrt(Math.pow(boss.x - player.x, 2) + Math.pow(boss.y - player.y, 2));
            if (dist < 70 && boss.attackCooldown === 0) {
                player.health -= boss.damage;
                boss.attackCooldown = 90; // 1.5 —Å–µ–∫—É–Ω–¥—ã –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏
            }
        }
        
        // –ê—Ç–∞–∫–∞ –∏–≥—Ä–æ–∫–∞
        function playerAttack() {
            if (attackCooldown > 0) return;
            
            attackCooldown = 30; // 0.5 —Å–µ–∫—É–Ω–¥—ã –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ø–∞–ª–∞ –ª–∏ –∞—Ç–∞–∫–∞ –ø–æ –≤—Ä–∞–≥–∞–º
            enemies.forEach(enemy => {
                const dist = Math.sqrt(Math.pow(enemy.x - player.x, 2) + Math.pow(enemy.y - player.y, 2));
                if (dist < 60) {
                    enemy.health -= 10;
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ø–∞–ª–∞ –ª–∏ –∞—Ç–∞–∫–∞ –ø–æ –±–æ—Å—Å—É
            if (boss) {
                const dist = Math.sqrt(Math.pow(boss.x - player.x, 2) + Math.pow(boss.y - player.y, 2));
                if (dist < 80) {
                    boss.health -= 5;
                }
            }
        }
        
        // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (!gameRunning) return;
            
            // –û—á–∏—â–∞–µ–º canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            update();
            
            // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
            drawBlocks();
            drawEnemies();
            drawPlayer();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∫–∞–¥—Ä
            requestAnimationFrame(gameLoop);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à
        const keys = {};
        
        window.addEventListener('keydown', e => {
            if (!gameRunning) return;
            keys[e.key] = true;
            
            // –ü—Ä—ã–∂–æ–∫
            if ((e.key === ' ' || e.key === 'w' || e.key === 'W' || e.key === '—Ü' || e.key === '–¶') && player.grounded) {
                player.velocityY = -player.jumpForce;
            }
            
            // –ê—Ç–∞–∫–∞
            if (e.key === ' ') {
                playerAttack();
            }
            
            // –ö—Ä–∞—Ñ—Ç
            if (e.key === 'c' || e.key === 'C' || e.key === '—Å' || e.key === '–°') {
                alert('–ú–µ–Ω—é –∫—Ä–∞—Ñ—Ç–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å!');
            }
        });
        
        window.addEventListener('keyup', e => {
            keys[e.key] = false;
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è
        function handleMovement() {
            player.velocityX = 0;
            
            if (keys['a'] || keys['A'] || keys['—Ñ'] || keys['–§']) {
                player.velocityX = -player.speed;
            }
            if (keys['d'] || keys['D'] || keys['–≤'] || keys['–í']) {
                player.velocityX = player.speed;
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –±–ª–æ–∫–∞–º
        canvas.addEventListener('click', e => {
            if (!gameRunning) return;
            
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left + camera.x;
            const mouseY = e.clientY - rect.top + camera.y;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–ª–∏–∫–Ω—É–ª–∏ –ª–∏ –º—ã –ø–æ –±–ª–æ–∫—É
            for (let i = 0; i < blocks.length; i++) {
                const block = blocks[i];
                if (
                    mouseX > block.x &&
                    mouseX < block.x + block.width &&
                    mouseY > block.y &&
                    mouseY < block.y + block.height
                ) {
                    if (blockTypes[block.type].breakable) {
                        blocks.splice(i, 1);
                        player.blocks++;
                    }
                    break;
                }
            }
        });
        
        canvas.addEventListener('contextmenu', e => {
            if (!gameRunning) return;
            e.preventDefault();
            
            if (player.blocks <= 0) return;
            
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left + camera.x;
            const mouseY = e.clientY - rect.top + camera.y;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ –∫–æ–ª–ª–∏–∑–∏–π —Å –∏–≥—Ä–æ–∫–æ–º –∏–ª–∏ –¥—Ä—É–≥–∏–º–∏ –±–ª–æ–∫–∞–º–∏
            let canPlace = true;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–ª–∏–∑–∏—é —Å –∏–≥—Ä–æ–∫–æ–º
            if (
                mouseX > player.x - 40 &&
                mouseX < player.x + player.width + 40 &&
                mouseY > player.y - 40 &&
                mouseY < player.y + player.height + 40
            ) {
                canPlace = false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–ª–∏–∑–∏—é —Å –¥—Ä—É–≥–∏–º–∏ –±–ª–æ–∫–∞–º–∏
            blocks.forEach(block => {
                if (
                    mouseX > block.x - 40 &&
                    mouseX < block.x + block.width + 40 &&
                    mouseY > block.y - 40 &&
                    mouseY < block.y + block.height + 40
                ) {
                    canPlace = false;
                }
            });
            
            if (canPlace) {
                blocks.push({
                    x: Math.round(mouseX / 40) * 40,
                    y: Math.round(mouseY / 40) * 40,
                    width: 40,
                    height: 40,
                    type: selectedBlock
                });
                player.blocks--;
            }
        });
        
        // –í—ã–±–æ—Ä –±–ª–æ–∫–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ
        inventorySlots.forEach(slot => {
            slot.addEventListener('click', () => {
                inventorySlots.forEach(s => s.classList.remove('active'));
                slot.classList.add('active');
                selectedBlock = slot.getAttribute('data-block');
            });
        });
        
        // –ö–Ω–æ–ø–∫–∞ –∞—Ç–∞–∫–∏
        attackBtn.addEventListener('click', playerAttack);
        
        // –ö–Ω–æ–ø–∫–∞ –∫—Ä–∞—Ñ—Ç–∞
        craftBtn.addEventListener('click', () => {
            alert('–ú–µ–Ω—é –∫—Ä–∞—Ñ—Ç–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å!');
        });
        
        // –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        saveBtn.addEventListener('click', () => {
            alert('–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞! (–í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª–æ –±—ã –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä)');
            // –ó–¥–µ—Å—å –±—ã–ª –±—ã –∫–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ PHP
        });
        
        // –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        loadBtn.addEventListener('click', () => {
            alert('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! (–í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ –∑–∞–≥—Ä—É–∑–∏–ª–æ –±—ã –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞)');
            // –ó–¥–µ—Å—å –±—ã–ª –±—ã –∫–æ–¥ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ PHP
        });
        
        // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
        restartBtn.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            player.health = 100;
            player.enemiesDefeated = 0;
            gameLevel = 1;
            generateWorld();
            gameRunning = true;
            gameLoop();
        });
        
        // –ö–Ω–æ–ø–∫–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
        nextLevelBtn.addEventListener('click', () => {
            victoryScreen.style.display = 'none';
            player.health = 100;
            player.enemiesDefeated = 0;
            gameLevel = 1;
            generateWorld();
            gameRunning = true;
            gameLoop();
        });
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        generateWorld();
        gameLoop();
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–≤–∏–∂–µ–Ω–∏—è
        setInterval(handleMovement, 1000/60);
    </script>
</body>
</html>